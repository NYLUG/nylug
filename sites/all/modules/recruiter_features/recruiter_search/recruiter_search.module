<?php

include_once('recruiter_search.features.inc');

/**
 * Implements hook_recruiter_search_block_view_alter().
 *
 * Removes [all items] from the current search block in case we have some active
 * filters (this entry is generated by the Search API in the Facet API apdater).
 * Furthermore a reset search link is added. Both changes are maybe useful for
 * the Search API as well.
 */
function recruiter_search_block_view_alter(&$data, $block) {
  if ($block->delta == 'recruiter_current_search' && $block->module == 'current_search') {
    if (isset($data['content']['active_items']['#items'])) {
      if (count($data['content']['active_items']['#items']) > 1 && $data['content']['active_items']['#items'][0] == '[' . t('all items') . ']') {
        // Remove the [all items] entry in case we have other active facets.
        unset($data['content']['active_items']['#items'][0]);
      }
      if ((isset($data['content']['active_items']['#items'][0]) && $data['content']['active_items']['#items'][0] != '[' . t('all items') . ']') ||
          isset($data['content']['active_items']['#items'][1])) {
        // Add the reset search link in case we do not show all items.
        $data['content']['active_items']['#items'][] = l(t('Reset search'), $_GET['q']);
      }
    }
  }
}
